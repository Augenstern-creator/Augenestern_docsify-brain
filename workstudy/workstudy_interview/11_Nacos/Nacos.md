# 1、Nacos

Nacos是一个更易于构建云原生应用的**动态服务发现、配置管理**和**服务管理平台**。它提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。Nacos致力于帮助用户发现、配置和管理微服务。

## 1.1、为什么选择Nacos

Nacos是是一个非常优秀的微服务解决方案：

1. **动态服务发现**：Nacos能够实现服务的动态发现，使得在运行时可以方便地添加或删除服务实例，而无需修改代码或重新启动应用。
2. **动态配置管理**：Nacos提供了一个集中式的配置管理服务，可以方便地对微服务进行配置管理，并且支持基于策略的配置管理，使得您可以根据不同的环境、用户角色、区域等设置不同的配置。
3. **流量管理**：Nacos支持流量的管理，可以方便地对服务的流量进行控制、限流和熔断等操作，保障服务的稳定性和可用性
3. **服务元数据管理**：Nacos能够收集并管理服务的元数据信息，包括服务的名称、版本号、描述等信息，方便开发人员快速了解服务的信息并进行相关操作。
3. **社区活跃**：Nacos的社区非常活跃，有大量的开源贡献者和用户



## 1.2、列举Nacos的主要功能特性

Nacos的主要功能特性包括：

1. **服务发现与服务健康检查**：Nacos使服务更容易注册，并通过DNS或HTTP接口发现其他服务。同时，Nacos还提供服务的实时健康检查，以防止向不健康的主机或服务实例发送请求。
2. **动态配置管理**：动态配置服务允许在所有环境中以集中和动态的方式管理所有服务的配置。Nacos消除了在更新配置时重新部署应用程序的需要，使配置的更改更加高效和灵活。
3. **动态DNS服务**：Nacos提供基于DNS协议的服务发现能力，旨在支持异构语言的服务发现，支持将注册在Nacos上的服务以域名的方式暴露断点，让三方应用方便的查阅及发现。
4. **服务和元数据管理**：Nacos允许从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及其安全策略。



## 1.3、Nacos作为服务注册中心的核心部件和功能

Nacos作为服务注册中心的核心部件和功能主要包括以下几点：

1. **服务注册**：Nacos允许服务提供者通过发送REST请求的方式向Nacos Server注册自己的服务，提供自身的元数据，如IP地址、端口信息等。Nacos Server收到注册请求后，会将元数据信息存储在一个双层Map中。
2. **服务同步**：Nacos Server集群之间会同步服务实例，以保证服务信息的一致性。





## 1.4、简述Nacos的命名空间Namespace

Nacos的命名空间（Namespace）是用于实现环境隔离的概念。它主要用于企业级开发中，区分不同的环境，例如开发环境（dev）、测试环境（test）和生产环境（pro）。每个命名空间都拥有唯一的ID，并且命名空间提供了对配置集的组织和隔离。默认情况下，所有配置在没有指定命名空间的情况下都位于一个公共命名空间中。





## 1.5、简述什么是业务隔离-Group分组

业务隔离-Group分组是Nacos中的一种配置管理方式。

- 例如，在一个学生管理系统中，可以定义一个名为`STUDENT_GROUP`的分组，用于管理相关的配置集。
- 在Nacos中，可以通过命名空间（namespace）进行不同环境的配置隔离，例如开发环境、测试环境和生产环境，因为它们的配置可能各不相同。
- 命名空间可以用于隔离不同的用户和开发人员，使得他们能够使用不同的配置集。在编写程序获取配置集过程中，如果没有感知到命名空间参数的输入，Nacos会使用一个默认的命名空间作为输入。
- Nacos还支持多种配置格式，例如YAML、Properties、TEXT、JSON、XML和HTML等，可以导入和导出配置集，也可以克隆配置集到其他命名空间。



## 1.6、简述Nacos的集群部署模式

Nacos支持三种集群部署模式：单机模式、集群模式和多集群模式。

1. **单机模式**：仅用于测试和单机试用，不适合生产环境。
2. **集群模式**：适用于生产环境，确保高可用性。可以部署多台Nacos服务器组成一个集群，实现负载均衡和故障转移。
3. **多集群模式**：适用于多数据中心场景。可以部署多个Nacos集群，每个集群运行在不同的物理或虚拟机上，实现跨地域的高可用性和容灾能力。

在集群部署模式下，为了解决客户端访问Nacos服务器时需要修改配置的问题，引入了地址服务器。Nacos的客户端去获取Nacos集群信息，然后随机选择一台Nacos节点通信，实现负载均衡。当Nacos部署变更后，客户端不需要修改配置，可以实现动态添加和删除Nacos节点。

还有一种基于VIP的部署模式。在这种模式下，客户端与真实IP解耦合，一般在内网使用。通过引入VIP组件，负载均衡器变化相对较小，而集群变化较快。因此，使用VIP可以减少客户端和真实IP之间的耦合性。







## 1.7、简述什么是Nacos的自我保护机制

Nacos的自我保护机制主要包括以下几个方面：

1. **健康检查保护**：Nacos通过定时发送心跳检测请求，检查服务的健康状态。当服务出现异常或不可用时，Nacos会根据预设的规则进行相应的处理，比如将异常服务从服务列表中移除，避免请求流量继续流向问题服务。这种保护机制可以有效降低异常服务对整个系统的影响，提高系统的可用性。
2. **流量控制保护**：Nacos可以根据服务的实际情况，设置流量控制规则，限制每个服务的最大请求次数或并发请求数。当服务的请求达到或超过限制时，Nacos会自动拒绝后续的请求，避免服务过载。这种保护机制可以防止系统因过高的请求负载而崩溃，保证系统的稳定性。

这些自我保护机制可以帮助Nacos在面对异常情况时，自动进行调节和处理，以保证系统的稳定性和可用性。同时，Nacos还提供了丰富的功能和工具，帮助用户简化保护机制的实现和管理，提高系统的安全性和可靠性。



## 1.8、请列举Nacos支持哪些协议

Nacos支持多种协议，包括但不限于以下几种：

1. DNS协议：Nacos可以通过DNS协议进行服务注册和发现，支持将注册在Nacos上的服务以域名的方式暴露断点，方便第三方应用访问。
2. HTTP协议：Nacos可以通过HTTP协议进行服务注册和发现，支持RESTful API接口，可以方便地与其他系统进行集成。
3. gRPC协议：Nacos也支持gRPC协议，这是一种高性能、跨语言的RPC框架，可以支持多种编程语言。







## 1.9、Nacos配置中心宕机了，我们的服务还可以读取到配置信息吗

当Nacos配置中心宕机时，我们的服务仍然可以读取到配置信息。

1. 首先，在服务启动时，Nacos客户端会首先从本地读取配置信息，这可以确保在配置中心不可用时，服务仍然可以启动并运行。
2. 其次，Nacos客户端还可以定时向Nacos配置中心发送请求，尝试拉取更新的配置信息。即使配置中心宕机，客户端也可以从本地获取到最新的配置信息，并更新本地内存中的配置。
3. 此外，当数据发生变化时，Nacos会通知它维护的客户端，然后客户端会去获取更新的数据。获取到新的配置数据后，客户端会在下次访问资源时更新对应的属性值。





## 1.10、简述 Nacos和Eureka区别

Nacos和Eureka都是注册中心，用于服务的注册和发现，但它们在保护机制、范围、特性以及部署模式上存在一些不同：



1. **保护方式**：Eureka的保护方式是在统计续约失败的比例达到一定阈值时，触发自我保护机制，在该机制下，Eureka Server不会剔除任何的微服务，等到正常后，再退出自我保护机制。而Nacos的保护方式是在域名健康实例占总服务实例的比例小于阈值时，无论实例是否健康，都会将这个实例返回给客户端。
2. **范围**：Nacos的阈值是针对某个具体Service的，而不是针对所有服务的。但Eureka的自我保护阈值是针对所有服务的。
3. **特性**：Nacos提供了一组简单易用的特性集，如动态服务发现、服务配置、服务元数据及流量管理，帮助用户快速实现需求。
4. **部署模式**：Eureka支持AP模式，而Nacos既支持AP也支持CP模式。









## 1.11、Nacos中的保护阈值的作用

- 在Nacos中，保护阈值是一种保护服务实例的机制。当某个服务实例出现故障或异常时，Nacos会通过心跳检测等方式将其从服务列表中移除，以避免客户端继续向其发送请求。然而，如果移除的实例过多，可能会导致服务的可用性降低。因此，Nacos引入了保护阈值机制来避免这种情况的发生。

- 保护阈值的作用是当服务实例的健康状态低于指定的阈值时，Nacos将不再将其从服务列表中移除。例如，如果将保护阈值设置为0.5，当服务实例的健康状态低于50%时，Nacos将不再移除该实例。这样可以保证即使出现故障或异常，仍然能够保留一定数量的服务实例，从而提高服务的可用性。

- 需要注意的是，保护阈值并不能解决服务实例的故障或异常问题，它只是一种机制来避免过度移除服务实例的问题。因此，在实际使用过程中，还需要针对服务实例的故障或异常问题进行监控和修复，以确保服务的正常运行。



## 1.12、简述Nacos中保证的是CP还是AP

- Nacos既保证了AP（可用性）也保证了CP（一致性）





## 1.13、Nacos的就近访问是什么意思

在Nacos中，就近访问指的是在服务间调用时，Nacos优先选择同一个集群内的实例进行调用。这是Nacos的集群部署模式之一，可以有效提高服务调用的效率。





## 1.14、Nacos中的负载均衡底层是如何实现的

Nacos的负载均衡底层是通过内置的Ribbon实现的，Ribbon是Netflix开源的一款优秀的负载均衡器。它提供了丰富的负载均衡策略，例如轮询、随机、加权轮询和加权随机等。在Nacos中，默认的负载均衡策略是轮询，即按照顺序依次将请求分发到每个服务实例上。

- 当请求量较小时，轮询算法能够保证每个服务实例都能够得到均等的请求量。但是当请求量较大时，轮询算法可能导致某些服务实例的负载过高，从而影响系统的性能。

为了解决这个问题，Nacos还提供了按权重策略来实现负载均衡。在配置了对应Nacos的服务启动后，可以在服务管理中对每个服务实例进行权重分配。针对这些实例，就可以根据各自的性能等其他因素进行合理的权重分配，实现权重轮询的负载均衡策略。





## 1.15、Nacos服务是如何判定服务实例的状态

Nacos通过心跳检测机制来判定服务实例的状态。

- 客户端向Nacos发送心跳，Nacos在规定时间内未收到心跳则认为该实例不健康，如果超过30秒未收到心跳，则将该实例删除。
- 对于临时实例，Nacos不会对其进行持久化存储，只能通过心跳方式保活。
- 而对于持久化实例，Nacos会对其进行持久化处理，当该实例不存在时，只会将其健康状态设置为不健康，但并不会立即从服务端删除。



## 1.16、简述Nacos如何共享配置

Nacos可以通过命名空间来实现配置共享。













