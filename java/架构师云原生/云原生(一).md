# 1ã€äº‘åŸç”Ÿ





## 1.1ã€ä¸“æœ‰ç½‘ç»œVPC

![](äº‘åŸç”Ÿ(ä¸€).assets/1.png)

æ¯ä¸ªECSéƒ½æœ‰ä¸€ä¸ªå…¬ç½‘IPã€ç§æœ‰IPï¼Œç§æœ‰IPæ˜¯å›ºå®šçš„ä¸ä¼šå˜åŠ¨çš„ï¼Œå¹¶ä¸”é›†ç¾¤å†…çš„å„ä¸ªECSçš„é€šä¿¡éƒ½æ˜¯èµ°ç§æœ‰IPçš„ï¼š

- å› ä¸ºç§æœ‰IPæ›´å¿«ï¼Œä¸”ä¸äº§ç”Ÿæµé‡è´¹ç”¨ã€‚

- å…¬ç½‘IPä¹‹é—´é€šä¿¡æ˜¯ä¼šäº§ç”Ÿæµé‡è´¹ç”¨çš„ã€‚å…¬ç½‘ipä¹Ÿæœ‰å¸¦å®½é™åˆ¶ã€‚

> è‡ªå·±è´­ä¹°çš„äº‘æœåŠ¡å™¨ECSï¼Œå…¶å®é»˜è®¤æ˜¯åŠ å…¥äº†ä¸€ä¸ªä¸“æœ‰ç½‘ç»œVPC,ç§æœ‰IPæ˜¯ç”±è¿™ä¸ªVPCæ¥ç»™å®šçš„ã€‚

![](äº‘åŸç”Ÿ(ä¸€).assets/2.png)



ä¸€ä¸ªVPCç”¨16ä½æ©ç çš„è¯ï¼Œå¯ä»¥åˆ†é…65536ä¸ªç§æœ‰IPã€‚å¦‚ä¸Šå›¾ï¼Œ192.168.0.0 - 192.168.255.255ï¼Œå¹¶ä¸”VPCä¸‹æˆ‘ä»¬å¯ä»¥æ–°å»ºäº¤æ¢æœºæ¥åˆ†é…å¯ç”¨åŒºï¼Œå¦‚ä¸Šå›¾ï¼Œä¸¤ä¸ªäº¤æ¢æœºåˆ†é…äº†ä¸¤ä¸ªå¯ç”¨åŒºABã€‚

- å¯ç”¨åŒºAå¯åˆ†é…254å°ECSçš„ç§æœ‰IP
- å¯ç”¨åŒºBå¯åˆ†é…254å°ECSçš„ç§æœ‰IP
- å‰©ä½™æœªåˆ†é…çš„ipä¸å¯ç”¨
- **åŒä¸€VPCä¸‹çš„æœåŠ¡å™¨å¯äº’é€šï¼ŒåŒä¸€VPCä¸‹çš„ä¸¤ä¸ªä¸åŒå¯ç”¨åŒºï¼ˆä¸åŒäº¤æ¢æœºï¼‰çš„æœåŠ¡å™¨å¯äº’é€š**
- **ä¸åŒvpcä¸‹çš„æœåŠ¡å™¨åœ¨ç‰©ç†å±‚åšäº†ç½‘ç»œéš”ç¦»ï¼Œä¸å¯äº’é€š**

![](äº‘åŸç”Ÿ(ä¸€).assets/3.png)



> æ¨è:[å­ç½‘è®¡ç®—](https://www.sojson.com/convert/subnet.html)

## 1.2ã€Docker

![](äº‘åŸç”Ÿ(ä¸€).assets/4.png)

Dockerå·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œå¤§è‡´å¤ä¹ ä¸‹ï¼š

1. Docker_Hostï¼šå®‰è£…Dockerçš„ä¸»æœºï¼Œä¹Ÿå°±æ˜¯å®¿ä¸»æœº,Linux
2. Registryï¼šé•œåƒä»“åº“ï¼Œä¹Ÿå°±æ˜¯DockerHub
3. Imagesï¼šé•œåƒï¼Œä¸€èˆ¬å°†é•œåƒæ‹‰å–åˆ°Linuxä¸Šï¼Œå¯åŠ¨è¿è¡Œåå˜ä¸ºå®¹å™¨Containers
4. Clientï¼šæ“ä½œDockerä¸»æœºçš„å®¢æˆ·ç«¯ï¼ˆå‘½ä»¤è¡Œã€UIç­‰ï¼‰

> æ•´ä½“æµç¨‹ä¸ºå®‰è£…Dockerï¼Œæ‹‰å–é•œåƒï¼Œè¿è¡Œé•œåƒå˜ä¸ºå®¹å™¨

```bash
yum install nginx

whereis nginx

cd /etc/nginx

# ä»é…ç½®æ–‡ä»¶å¯ä»¥çœ‹å‡º index.html æ˜¯åœ¨ /usr/share/nginx/html ä¸‹çš„
cat nginx.conf

systemctl start nginx
```

> å¦‚æœè®¿é—®ä¸é€šnginxè®°å¾—å¼€é€šæœåŠ¡å™¨çš„é˜²ç«å¢™80ç«¯å£





# 2ã€Kubernetes

- è¯»éŸ³ï¼š**é…·åšå¥ˆå¿’ä¸ï¼ˆK8sï¼‰**

è°ˆèµ· k8s çš„å‘å±•å†å²ï¼Œé¦–å…ˆå›é¡¾ä¸€ä¸‹é¡¹ç›®éƒ¨ç½²çš„å‘å±•å†ç¨‹ï¼Œåˆ†å¸ƒç»å†äº†ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å®¹å™¨åŒ–ä¸‰ä¸ªé˜¶æ®µçš„æ¼”å˜ã€‚

1. **ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£**ï¼šæ—©æœŸï¼Œåº”ç”¨ç¨‹åºç›´æ¥åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œæ— æ³•ä¸ºç‰©ç†æœåŠ¡å™¨ä¸­çš„åº”ç”¨ç¨‹åºå®šä¹‰èµ„æºè¾¹ç•Œï¼Œè¿™ä¼šå¯¼è‡´èµ„æºåˆ†é…é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨ç¨‹åºå ç”¨å¤§éƒ¨åˆ†èµ„æºçš„æƒ…å†µï¼Œç»“æœå¯èƒ½å¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ç”±äºèµ„æºåˆ©ç”¨ä¸è¶³è€Œæ— æ³•æ‰©å±•ï¼Œå¹¶ä¸”ç»´æŠ¤è®¸å¤šç‰©ç†æœåŠ¡å™¨çš„æˆæœ¬å¾ˆé«˜ã€‚
2. **è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£**ï¼šä¸ºäº†è§£å†³ç‰©ç†æœºå­˜åœ¨çš„å¼Šç«¯ï¼Œå¼•å…¥äº†è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œæ”¯æŒåœ¨å•ä¸ªç‰©ç†æœåŠ¡å™¨çš„ CPU ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼ˆVMï¼‰ï¼Œæ¯ä¸ª VM æ˜¯ä¸€å°å®Œæ•´çš„è®¡ç®—æœºï¼Œåœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶ä¹‹ä¸Šè¿è¡Œæ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿã€‚è™šæ‹ŸåŒ–æŠ€æœ¯å…è®¸åº”ç”¨ç¨‹åºåœ¨ VM ä¹‹é—´éš”ç¦»ï¼Œæä¾›ä¸€å®šç¨‹åº¦çš„å®‰å…¨ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ä¸èƒ½è¢«å¦ä¸€åº”ç”¨ç¨‹åºéšæ„è®¿é—®ã€‚è™šæ‹ŸåŒ–æŠ€æœ¯èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç‰©ç†æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œç”±äºå¯è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°åº”ç”¨ç¨‹åºè€Œå®ç°æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ï¼Œé™ä½äº†ç¡¬ä»¶æˆæœ¬ã€‚
3. **å®¹å™¨éƒ¨ç½²æ—¶ä»£**ï¼šå®¹å™¨ç±»ä¼¼äº VMï¼Œä½†æ˜¯å…·æœ‰è¢«æ”¾å®½çš„éš”ç¦»å±æ€§ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å®¹å™¨è¢«è®¤ä¸ºæ˜¯è½»é‡çº§çš„éš”ç¦»ã€‚å®¹å™¨ä¸ VM ç±»ä¼¼ï¼Œå…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ï¼Œç”±äºå®ƒä»¬ä¸åŸºç¡€æ¶æ„åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥è·¨äº‘å’Œæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆæœ¬è¿›è¡Œç§»æ¤ã€‚

> é—®é¢˜å‡ºç°ï¼šä¸€æ—¦å®¹å™¨å¤šäº†ï¼Œå¦‚ä½•è¿›è¡Œç®¡ç†ï¼Ÿ

éšç€å¾®æœåŠ¡ã€å®¹å™¨åŒ–ç­‰æŠ€æœ¯çš„å‘å±•ï¼Œè§£å†³äº†èµ„æºåˆ©ç”¨ç‡ä¸é«˜çš„é—®é¢˜ï¼Œä½†æ˜¯éšä¹‹è€Œæ¥å´æ˜¯å¦‚ä½•è¿›è¡Œå®¹å™¨ç®¡ç†ï¼Œè¿‡å¤šçš„å®¹å™¨ä½¿å¾—è¿ç»´å·¥ä½œä¹Ÿæˆä¸ºäº†ä¸€ç§è´Ÿæ‹…ï¼Œå› æ­¤**å®¹å™¨ç¼–æ’**å¯¹äºå¤§å‹ä¾æ‰˜äºå®¹å™¨åŒ–éƒ¨ç½²çš„åˆ†å¸ƒå¼ç³»ç»Ÿè‡³å…³é‡è¦ã€‚K8så°±æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼š

- **æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡**ï¼šKubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€å…¬å¼€å®¹å™¨ï¼Œå¦‚æœè¿›å…¥å®¹å™¨çš„æµé‡å¾ˆå¤§ï¼Œ Kubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚
- **å­˜å‚¨ç¼–æ’**ï¼šKubernetes å…è®¸ä½ è‡ªåŠ¨æŒ‚è½½ä½ é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚æœ¬åœ°å­˜å‚¨ã€å…¬å…±äº‘æä¾›å•†ç­‰ã€‚
- **è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š**ï¼šä½ å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œå®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€æ›´æ”¹ä¸ºæœŸæœ›çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è‡ªåŠ¨åŒ– Kubernetes æ¥ä¸ºä½ çš„éƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œ åˆ é™¤ç°æœ‰å®¹å™¨å¹¶å°†å®ƒä»¬çš„æ‰€æœ‰èµ„æºç”¨äºæ–°å®¹å™¨ã€‚
- **è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®—**ï¼šKubernetes å…è®¸ä½ æŒ‡å®šæ¯ä¸ªå®¹å™¨æ‰€éœ€ CPU å’Œå†…å­˜ï¼ˆRAMï¼‰ã€‚ å½“å®¹å™¨æŒ‡å®šäº†èµ„æºè¯·æ±‚æ—¶ï¼ŒKubernetes å¯ä»¥åšå‡ºæ›´å¥½çš„å†³ç­–æ¥ç®¡ç†å®¹å™¨çš„èµ„æºã€‚
- **è‡ªæˆ‘ä¿®å¤**ï¼šKubernetes é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„ è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡å¥½æœåŠ¡ä¹‹å‰ä¸å°†å…¶é€šå‘Šç»™å®¢æˆ·ç«¯ã€‚
- **å¯†é’¥ä¸é…ç½®ç®¡ç†**ï¼šKubernetes å…è®¸ä½ å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ã€‚ ä½ å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚



## 2.1ã€ç»„ç»‡æ¶æ„

- k8s é›†ç¾¤ = å¤šä¸ª master node + å¤šä¸ª work node
  - Kubernetes **Cluster** **=** N **Master** Node **+** N **Worker** Node
  - N ä¸»èŠ‚ç‚¹ + N å·¥ä½œèŠ‚ç‚¹ï¼› N>=1

![](äº‘åŸç”Ÿ(ä¸€).assets/6.png)

â€‹	k8s é€šå¸¸æ˜¯é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œä¸€ä¸ª k8s é›†ç¾¤ç”±ä¸€ç»„è¢«ç§°ä½œèŠ‚ç‚¹ï¼ˆNodeï¼‰çš„æœºå™¨ç»„æˆï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥ç†è§£ä¸ºä¸€å°æœåŠ¡å™¨ï¼Œè¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œ k8s æ‰€ç®¡ç†çš„å®¹å™¨åŒ–åº”ç”¨ã€‚

â€‹	é›†ç¾¤å…·æœ‰è‡³å°‘ä¸€ä¸ª**æ§åˆ¶èŠ‚ç‚¹**ï¼ˆMasterNodeï¼‰å’Œè‹¥å¹²**å·¥ä½œèŠ‚ç‚¹**ï¼ˆWorkNodeï¼‰ï¼ŒèŠ‚ç‚¹å¯ä»¥æ˜¯ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚

â€‹	**æ§åˆ¶èŠ‚ç‚¹**åŒ…å«äº†**æ§åˆ¶å¹³é¢**ï¼ˆContro Planeï¼‰ï¼Œæ§åˆ¶å¹³é¢ä¸­çš„ç»„ä»¶ç”¨æ¥ç®¡ç†æ•´ä¸ªé›†ç¾¤ï¼Œ**å·¥ä½œèŠ‚ç‚¹**ç”¨æ¥æ‰˜ç®¡å¯¹åº”çš„å·¥ä½œè´Ÿè½½ Podã€‚

- **æ§åˆ¶å¹³é¢**ï¼šæ§åˆ¶å¹³é¢å¯ä»¥æ‰¾åˆ°ç”¨äºæ§åˆ¶é›†ç¾¤çš„ k8s ç»„ä»¶ä»¥åŠä¸€äº›æœ‰å…³é›†ç¾¤çŠ¶æ€å’Œé…ç½®çš„æ•°æ®ã€‚è¿™äº›æ ¸å¿ƒ k8s ç»„ä»¶è´Ÿè´£å¤„ç†é‡è¦çš„å·¥ä½œï¼Œä»¥ç¡®ä¿å®¹å™¨ä»¥è¶³å¤Ÿçš„æ•°é‡å’Œæ‰€éœ€çš„èµ„æºè¿è¡Œã€‚
- **kube-apiserver**ï¼šå¦‚æœéœ€è¦ä¸æ‚¨çš„ k8s é›†ç¾¤è¿›è¡Œäº¤äº’ï¼Œå°±è¦é€šè¿‡ APIã€‚k8s API æ˜¯ k8s æ§åˆ¶å¹³é¢çš„å‰ç«¯ï¼Œç”¨äºå¤„ç†å†…éƒ¨å’Œå¤–éƒ¨è¯·æ±‚ã€‚æ‚¨å¯ä»¥é€šè¿‡ kubeadm æ¥è®¿é—®APIã€‚
- **kube-scheduler**ï¼šæ‚¨çš„é›†ç¾¤æ˜¯å¦çŠ¶å†µè‰¯å¥½ï¼Ÿå¦‚æœéœ€è¦æ–°çš„å®¹å™¨ï¼Œè¦å°†å®ƒä»¬æ”¾åœ¨å“ªé‡Œï¼Ÿè¿™äº›æ˜¯ k8s è°ƒåº¦ç¨‹åºæ‰€è¦å…³æ³¨çš„é—®é¢˜ã€‚è°ƒåº¦ç¨‹åºä¼šè€ƒè™‘å®¹å™¨é›†çš„èµ„æºéœ€æ±‚ï¼ˆä¾‹å¦‚ CPU æˆ–å†…å­˜ï¼‰ä»¥åŠé›†ç¾¤çš„è¿è¡ŒçŠ¶å†µã€‚éšåï¼Œå®ƒä¼šå°†å®¹å™¨é›†å®‰æ’åˆ°é€‚å½“çš„è®¡ç®—èŠ‚ç‚¹ã€‚
- **kube-controller-manager**ï¼šæ§åˆ¶å™¨è´Ÿè´£å®é™…è¿è¡Œé›†ç¾¤ï¼Œè€Œ k8s æ§åˆ¶å™¨ç®¡ç†å™¨åˆ™æ˜¯å°†å¤šä¸ªæ§åˆ¶å™¨åŠŸèƒ½åˆè€Œä¸ºä¸€ã€‚æ§åˆ¶å™¨ç”¨äºæŸ¥è¯¢è°ƒåº¦ç¨‹åºï¼Œå¹¶ç¡®ä¿æœ‰æ­£ç¡®æ•°é‡çš„å®¹å™¨é›†åœ¨è¿è¡Œã€‚å¦‚æœæœ‰å®¹å™¨é›†åœæ­¢è¿è¡Œï¼Œå¦ä¸€ä¸ªæ§åˆ¶å™¨ä¼šå‘ç°å¹¶åšå‡ºå“åº”ã€‚æ§åˆ¶å™¨ä¼šå°†æœåŠ¡è¿æ¥è‡³å®¹å™¨é›†ï¼Œä»¥ä¾¿è®©è¯·æ±‚å‰å¾€æ­£ç¡®çš„ç«¯ç‚¹ã€‚è¿˜æœ‰ä¸€äº›æ§åˆ¶å™¨ç”¨äºåˆ›å»ºå¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œã€‚
- **etcd**ï¼šé…ç½®æ•°æ®ä»¥åŠæœ‰å…³é›†ç¾¤çŠ¶æ€çš„ä¿¡æ¯ä½äº etcdï¼ˆä¸€ä¸ªKVå­˜å‚¨æ•°æ®åº“ï¼‰ä¸­ã€‚etcd é‡‡ç”¨åˆ†å¸ƒå¼ã€å®¹é”™è®¾è®¡ï¼Œè¢«è§†ä¸ºé›†ç¾¤çš„æœ€ç»ˆäº‹å®æ¥æºã€‚
- **å®¹å™¨é›† Pod**ï¼šå®¹å™¨é›†æ˜¯ k8s å¯¹è±¡æ¨¡å‹ä¸­æœ€å°ã€æœ€ç®€å•çš„å•å…ƒã€‚å®ƒä»£è¡¨äº†åº”ç”¨çš„å•ä¸ªå®ä¾‹ã€‚æ¯ä¸ªå®¹å™¨é›†éƒ½ç”±ä¸€ä¸ªå®¹å™¨ï¼ˆæˆ–ä¸€ç³»åˆ—ç´§å¯†è€¦åˆçš„å®¹å™¨ï¼‰ä»¥åŠè‹¥å¹²æ§åˆ¶å®¹å™¨è¿è¡Œæ–¹å¼çš„é€‰ä»¶ç»„æˆã€‚å®¹å™¨é›†å¯ä»¥è¿æ¥è‡³æŒä¹…å­˜å‚¨ï¼Œä»¥è¿è¡Œæœ‰çŠ¶æ€åº”ç”¨ã€‚
- **å®¹å™¨è¿è¡Œæ—¶å¼•æ“**ï¼šä¸ºäº†è¿è¡Œå®¹å™¨ï¼Œæ¯ä¸ªè®¡ç®—èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶å¼•æ“ã€‚æ¯”å¦‚ dockerã€‚
- **kubelet**ï¼šæ¯ä¸ªè®¡ç®—èŠ‚ç‚¹ä¸­éƒ½åŒ…å«ä¸€ä¸ª kubeletï¼Œè¿™æ˜¯ä¸€ä¸ªä¸æ§åˆ¶å¹³é¢é€šä¿¡çš„å¾®å‹åº”ç”¨ã€‚kubelet å¯ç¡®ä¿å®¹å™¨åœ¨å®¹å™¨é›†å†…è¿è¡Œã€‚å½“æ§åˆ¶å¹³é¢éœ€è¦åœ¨èŠ‚ç‚¹ä¸­æ‰§è¡ŒæŸä¸ªæ“ä½œæ—¶ï¼Œkubelet å°±ä¼šæ‰§è¡Œè¯¥æ“ä½œã€‚
- **kube-proxy**ï¼šæ¯ä¸ªè®¡ç®—èŠ‚ç‚¹ä¸­è¿˜åŒ…å« kube-proxyï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºä¼˜åŒ– k8s ç½‘ç»œæœåŠ¡çš„ç½‘ç»œä»£ç†ã€‚kube-proxy è´Ÿè´£å¤„ç†é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œé€šä¿¡ã€‚

![](äº‘åŸç”Ÿ(ä¸€).assets/5.png)é€šä¿—è§£é‡Šï¼š

- K8sé›†ç¾¤å°±æ˜¯ç¡…è°·é›†å›¢ï¼Œé›†å›¢ä¸‹æœ‰ä¸€ä¸ªMasterä¸»èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„**æ§åˆ¶å¹³é¢**ï¼ˆContro Planeï¼‰ï¼Œç†è§£æœªç¡…è°·æ€»éƒ¨ï¼Œè¿˜æœ‰è‹¥å¹²åˆ†å‚Nodeï¼Œä¹Ÿå°±æ˜¯è‹¥å¹²WorkèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€å°æœåŠ¡å™¨ã€‚
- **kube-controller-manager**æ§åˆ¶å™¨ç®¡ç†å™¨å°±æ˜¯ç¡…è°·æ€»éƒ¨çš„å†³ç­–è€…ï¼Œ**etcd**æ˜¯é›†å›¢çš„èµ„æ–™åº“ï¼Œ**kube-apiserver**æ˜¯é›†å›¢çš„ç§˜ä¹¦ï¼Œè´Ÿè´£å¤„ç†å†…éƒ¨å’Œå¤–éƒ¨è¯·æ±‚ã€‚**kube-scheduler**æ˜¯é¡¹ç›®çš„è°ƒåº¦è€…ï¼Œæ¥è´Ÿè´£å“ªäº›å‚è´Ÿè´£å“ªäº›é¡¹ç›®ã€‚
- æ¯ä¸ªèŠ‚ç‚¹Nodeéƒ½æœ‰**kubelet**ï¼Œç†è§£ä¸ºå‚é•¿ï¼Œç§˜ä¹¦éƒ¨ä¸‹å‘ä»»åŠ¡ç»™å‚é•¿ï¼Œ**kube-proxy**æ˜¯å‚å­é‡Œé¢çš„ä»£ç†ï¼Œç†è§£ä¸ºé—¨å«å¤§çˆ·ï¼Œè´Ÿè´£å¤„ç†é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œé€šä¿¡ã€‚



## 2.2ã€ä¸€é”®å¼å®‰è£…

ä¸­æ–‡å®˜ç½‘ï¼š[https://kubesphere.io/zh/](https://kubesphere.io/zh/)

- è¯»éŸ³ï¼š**åº“ä¼¯ç‘Ÿfaiå„¿~**

1. æ–‡æ¡£ä¸­å¿ƒ - é€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬æ–‡æ¡£

![](äº‘åŸç”Ÿ(ä¸€).assets/9.png)

2. æˆ‘è¿™é‡Œé€‰æ‹©å•èŠ‚ç‚¹å®‰è£…,é¦–å…ˆä¸‹è½½KubeKey

![](äº‘åŸç”Ÿ(ä¸€).assets/10.png)



3. å®‰è£…å®Œæˆåï¼Œè¿˜éœ€è¦å®‰è£…ä¾èµ–é¡¹

![](äº‘åŸç”Ÿ(ä¸€).assets/11.png)



```bash
yum install -y socat conntrack ebtables ipset
```

4. å®‰è£…å®Œä¾èµ–å°±å¯ä»¥ä¸€å¥è¯å®‰è£… Kubernetes å’Œ KubeSphere äº†

> æ³¨æ„ï¼šhostnameå¿…é¡»å¾—è§„èŒƒï¼Œå»ºè®®`hostnamectl set-hostname k8s-master`

```bash
./kk create cluster --with-kubernetes v1.22.12 --with-kubesphere v3.4.1
```

![](äº‘åŸç”Ÿ(ä¸€).assets/12.png)

5. å¦‚æœå‡ºç°æŠ¥é”™ï¼Œ`Failed to exec command: sudo -E /bin/bash -c xxxx` è¿™ç§ï¼Œä¸€èˆ¬æ˜¯ç”±äºæ‚¨æ— æ³•ä» `dockerhub.io` ä¸‹è½½é•œåƒï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä¸ºdockeråˆ‡æ¢é•œåƒæº
   - æˆ‘è¿™é‡Œé‡‡ç”¨æ¯«ç§’é•œåƒ:[æ¯«ç§’é•œåƒ](https://1ms.run/)

```bash
echo '{"registry-mirrors": ["https://docker.1ms.run"]}' | sudo tee /etc/docker/daemon.json > /dev/null
systemctl daemon-reload
systemctl restart docker
```

6. æ¥ç€å†æ¬¡æ‰§è¡Œ

```bash
./kk create cluster --with-kubernetes v1.22.12 --with-kubesphere v3.4.1
```

![](äº‘åŸç”Ÿ(ä¸€).assets/13.png)



7. è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥æ£€æŸ¥å®‰è£…ç»“æœã€‚

```bash
kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l 'app in (ks-install, ks-installer)' -o jsonpath='{.items[0].metadata.name}') -f
```

è¾“å‡ºä¿¡æ¯ä¼šæ˜¾ç¤º Web æ§åˆ¶å°çš„ IP åœ°å€å’Œç«¯å£å·ï¼Œé»˜è®¤çš„ç«¯å£å·æ˜¯ `30880`ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤çš„å¸æˆ·å’Œå¯†ç  (`admin/P@88w0rd`) é€šè¿‡ `<NodeIP>:30880` è®¿é—®æ§åˆ¶å°

![](äº‘åŸç”Ÿ(ä¸€).assets/14.png)

## 2.3ã€å‘½ä»¤

> Kubectl æ˜¯ç”¨äºæ§åˆ¶ kubernetes é›†ç¾¤çš„å‘½ä»¤å·¥å…·ã€‚

è¯­æ³•æ ¼å¼ï¼š

```bash
kubectl command type name flages
```

- `command`: å­å‘½ä»¤ï¼Œå¦‚ createã€getã€describeã€delete
- `type`ï¼šèµ„æºç±»å‹ï¼Œå¯ä»¥è¡¨ç¤ºå•æ•°ã€å¤æ•°æˆ–ç¼©å†™å½¢å¼
- `name`ï¼šèµ„æºåç§°ã€‚
- `flags`ï¼šæŒ‡å®šå¯é€‰æ ‡å¿—ï¼Œæˆ–é™„åŠ çš„å‚æ•°

```bash
# æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹
kubectl get nodes

#æ ¹æ®é…ç½®æ–‡ä»¶ï¼Œç»™é›†ç¾¤åˆ›å»ºèµ„æº
kubectl apply -f xxxx.yaml

#æŸ¥çœ‹é›†ç¾¤éƒ¨ç½²äº†å“ªäº›åº”ç”¨ï¼Ÿ
docker ps   ===   kubectl get pods -A

# è¿è¡Œä¸­çš„åº”ç”¨åœ¨dockeré‡Œé¢å«å®¹å™¨ï¼Œåœ¨k8sé‡Œé¢å«Pod
kubectl get pods -A
```

- æŸ¥çœ‹é›†ç¾¤éƒ¨ç½²äº†å“ªäº›åº”ç”¨(ä¸€ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªpod):`kubectl get pod -A`

![](äº‘åŸç”Ÿ(ä¸€).assets/15.png)

- æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹:`kubectl get nodes`

![](äº‘åŸç”Ÿ(ä¸€).assets/16.png)





# 3ã€Kubernetesæ ¸å¿ƒæ¦‚å¿µ

## 3.0ã€èµ„æºåˆ›å»ºæ–¹å¼

K8sé‡Œé¢çš„èµ„æºåˆ›å»ºæœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯å‘½ä»¤è¡Œï¼Œç¬¬äºŒç§æ˜¯é€šè¿‡ç¼–å†™YAMLæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨`kubectl apply -f xxx.yaml` å‘½ä»¤æ¥åˆ›å»ºèµ„æºã€‚



## 3.1ã€Namespace

Namespace ç”¨æ¥éš”ç¦»èµ„æºï¼Œå¯¹é›†ç¾¤èµ„æºè¿›è¡Œéš”ç¦»åˆ’åˆ†ï¼Œé»˜è®¤åªéš”ç¦»èµ„æºï¼Œä¸éš”ç¦»ç½‘ç»œã€‚

> Namespaceæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç°**å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»**æˆ–è€…**å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»**ã€‚

ä¾‹å¦‚K8sé›†ç¾¤æœ‰ä¸‰å°æœºå™¨ï¼Œéƒ¨ç½²äº†ä¸‰ä¸ªåº”ç”¨ã€‚

![](äº‘åŸç”Ÿ(ä¸€).assets/18.png)

- ç”Ÿäº§ç¯å¢ƒå¯ä»¥ç”¨ä¸€ä¸ªNamespace -prod
- ç”Ÿäº§ç¯å¢ƒå¯ä»¥ç”¨ä¸€ä¸ªNamespace -dev
- åº”ç”¨Aåªèƒ½å¼•ç”¨ç”Ÿäº§prodä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œä¸èƒ½å¼•ç”¨å¼€å‘devä¸‹çš„é…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯æ•´ä½“ç½‘ç»œæ˜¯æ‰“é€šçš„ï¼Œå½“ç„¶ç½‘ç»œç­–ç•¥ä¹Ÿå¯ä»¥è®¾ç½®æ¥è¾¾åˆ°ç½‘ç»œéš”ç¦»ã€‚

### 3.1.1ã€æŸ¥çœ‹å‘½åç©ºé—´åˆ—è¡¨

```bash
# è·å–æ‰€æœ‰åç§°ç©ºé—´ - ç®€å†™
kubectl get ns 
kubectl get namespaces # å…¨å†™

#æŸ¥çœ‹namespace
kubectl get namespace
#æŸ¥çœ‹kube-systemå‘½åç©ºé—´ä¸‹çš„pod
kubectl get pods -n kube-system
#æŸ¥çœ‹æ‰€æœ‰namespaceä¸‹çš„pod
kubectl get pods -A
```

![](äº‘åŸç”Ÿ(ä¸€).assets/19.png)

kuberneteså¯åŠ¨æ—¶ä¼šåˆ›å»ºå››ä¸ªåˆå§‹å‘½åç©ºé—´ï¼š

- `default`:kubernetesåŒ…å«è¿™ä¸ªå‘½åç©ºé—´ï¼Œä»¥ä¾¿ä½ æ— éœ€åˆ›å»ºæ–°çš„å‘½åç©ºé—´å³å¯å¼€å§‹ä½¿ç”¨æ–°é›†ç¾¤

- `kube-node-lease`:è¯¥å‘½åç©ºé—´åŒ…å«ç”¨äºå„ä¸ªèŠ‚ç‚¹å…³è”çš„Lease(ç§Ÿçº¦)å¯¹è±¡ã€‚èŠ‚ç‚¹ç§Ÿçº¦å…è®¸kubeletå‘é€å¿ƒè·³ï¼Œç”±æ­¤æ§åˆ¶èƒ½å¤Ÿæ£€æµ‹åˆ°èŠ‚ç‚¹æ•…éšœã€‚

- `kube-public`:æ‰€æœ‰çš„å®¢æˆ·ç«¯(åŒ…æ‹¬æœªç»èº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯)éƒ½å¯ä»¥è¯»å–è¯¥å‘½åç©ºé—´ã€‚è¯¥å‘½åç©ºé—´ä¸»è¦é¢„ç•™æœªé›†ç¾¤ä½¿ç”¨ï¼Œä»¥ä¾¿æŸäº›èµ„æºéœ€è¦åœ¨æ•´ä¸ªé›†ç¾¤ä¸­å¯è§å¯è¯»ã€‚è¯¥å‘½åç©ºé—´çš„å…¬å±æ€§æ˜¯ä¸€ç§çº¦å®šè€Œéè¦æ±‚ã€‚

- `kube-system`:è¯¥å‘½åç©ºé—´ä½¿ç”¨kubernetesç³»ç»Ÿåˆ›å»ºçš„å¯¹è±¡ã€‚

```bash
# #æŸ¥çœ‹æ‰€æœ‰namespaceä¸‹çš„pod
kubectl get pods -A
```

![](äº‘åŸç”Ÿ(ä¸€).assets/20.png)



```bash
# è·å–é»˜è®¤defaultå‘½åç©ºé—´çš„è¿è¡Œçš„åº”ç”¨
kubectl get pods

# è·å–kube-systemå‘½åç©ºé—´è¿è¡Œçš„åº”ç”¨
kubectl get pods -n kube-system
```

![](äº‘åŸç”Ÿ(ä¸€).assets/21.png)



### 3.1.2ã€åˆ›å»ºå‘½åç©ºé—´

```bash
# åˆ›å»ºhelloå‘½åç©ºé—´
kubectl create ns hello
# åˆ é™¤helloå‘½åç©ºé—´
kubectl delete ns hello
```



å¦‚æœä½¿ç”¨`.yaml`æ¥åˆ›å»ºï¼Œåªéœ€æ–°å»ºä¸€ä¸ª`xx.yaml`ï¼Œå†™å…¥å¦‚ä¸‹ï¼Œç„¶åæ‰§è¡Œï¼š`kubectl apply -f xx.yaml`

```yaml
# ç‰ˆæœ¬å·(å›ºå®šå†™æ³•)
apiVersion: v1
# èµ„æºç±»å‹(å›ºå®šå†™æ³•)
kind: Namespace
# æºæ•°æ®
metadata:
  name: hello
```

å¦‚æœè¦åˆ é™¤ï¼Œä¹Ÿæ˜¯ä½¿ç”¨`.yaml`çš„æ–¹å¼åˆ é™¤ï¼Œæ‰§è¡Œï¼š`kubectl delete -f xx.yaml`

```bash
kubectl apply -f https://example.com/deploy.yaml

kubectl delete -f https://example.com/deploy.yaml
```



> æ³¨æ„:è‹¥åœ¨åˆ›å»ºèµ„æºæ—¶ä¸å†™å‘½åç©ºé—´ï¼Œé»˜è®¤æ”¾åœ¨defaultå‘½åç©ºé—´

### 3.1.3ã€æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…

```bash
# your_namespace ä¸ºä½ è‡ªå·±çš„å‘½åç©ºé—´åç§°
kubectl describe ns your_namespace 
```







## 3.2ã€Pod

Podæ˜¯Kubernetesä¸­åº”ç”¨çš„æœ€å°å•ä½ã€‚

![](äº‘åŸç”Ÿ(ä¸€).assets/17.png)



æˆ‘ä»¬ä¹‹å‰åœ¨Dockerä¸­è¿è¡Œçš„æ˜¯å®¹å™¨ï¼Œåœ¨å®¹å™¨ä¸­åˆåŠ è£…ä¸€å±‚å°±æ˜¯Podã€‚

- é€šä¿—ç†è§£ï¼š**Dockerä¸­çš„rediså®¹å™¨ã€mysqlå®¹å™¨ç­‰å¯ä»¥ä½åœ¨ä¸€ä¸ªPodå®¿èˆé‡Œé¢ã€‚**æ‰€ä»¥Podæ˜¯æŒ‡è¿è¡Œä¸­çš„ä¸€ç»„å®¹å™¨ã€‚
- è¿™æ ·æ˜¯K8sä¸ºäº†æ›´å¥½çš„ç®¡ç†å®¹å™¨ï¼Œ**å¯åŠ¨rediså®¹å™¨å°±å˜æˆäº†å¯åŠ¨å…¶æ‰€åœ¨çš„Pod**ã€‚
- ä¸€å¥è¯è§£é‡Šï¼šå­¦ç”Ÿä½å®¿èˆï¼Œå¯ä½å•é—´ï¼Œå¯ä½å¤šäººé—´ï¼Œç®¡ç†å­¦ç”Ÿå°±å˜ä¸ºä»¥å®¿èˆä¸ºå•ä½ç®¡ç†ã€‚

![](äº‘åŸç”Ÿ(ä¸€).assets/15.png)

ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ° READY å­—æ®µæ˜¯ 1/1ï¼Œä¹Ÿå°±æ˜¯1ä¸ªå®¹å™¨ä½ä¸€ä¸ªPodã€‚å¦‚æœæ˜¯1/2ï¼Œè¯´æ˜è¿™ä¸ªPodæœ‰1ä¸ªå®¹å™¨æ²¡åœ¨å·¥ä½œã€‚

å¥½ï¼ç°åœ¨æˆ‘ä»¬æ¥å®šä¹‰Podï¼š

- ç”±ä¸€ä¸ªå®¹å™¨æˆ–å¤šä¸ªå®¹å™¨ç»„æˆ(æœ€å°‘ä¸€ä¸ªå®¹å™¨)
- æ˜¯k8sä¸­æœ€å°çš„ç®¡ç†å…ƒç´ 
- **åŒä¸€ä¸ªPodå…±äº«IPåŠæƒé™,ä¸»æœºåç§°,å…±äº«å­˜å‚¨è®¾å¤‡,å‘½åç©ºé—´**



### 3.2.1ã€è·å–å‘½åç©ºé—´ä¸‹Podåˆ—è¡¨

```bash
# your_namespaceä¸ºä½ è‡ªå·±çš„å‘½åç©ºé—´åç§°
kubectl get pods -n your_namespace -o wide -w 
```

- -n æŒ‡å®šå‘½åç©ºé—´ 
- -o wide æ˜¾ç¤ºæ›´åŠ è¯¦ç»†ä¿¡æ¯
- -o name åªæ˜¾ç¤ºåå­—
- -o yaml/json  ä»¥yaml/jsonè¯­æ³•æ ¼å¼æ˜¾ç¤ºèµ„æºå¯¹è±¡
- -w æŒç»­ç›‘å¬





### 3.2.2ã€åˆ›å»ºå¹¶è¿è¡ŒPod

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•åˆ›å»ºå¹¶è¿è¡ŒPodï¼š

```bash
# kubectl run [podåç§°] --image=[é•œåƒ]:[é•œåƒç‰ˆæœ¬] --port=[å¯¹å¤–ç«¯å£] --namespace [namespace]

# podçš„åå­—ä¸º mynginx
# åˆ›å»ºçš„podé»˜è®¤åœ¨defaultå‘½åç©ºé—´
kubectl run mynginx --image=nginx

# æŸ¥çœ‹defaultåç§°ç©ºé—´çš„Pod
kubectl get pods
```

![](äº‘åŸç”Ÿ(ä¸€).assets/22.png)

### 3.2.3ã€æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯

```bash
# æè¿° 
# kubectl describe pod your_pod -n your_namespace 
# your_podä¸ºè‡ªå·±çš„podåç§°ï¼Œyour_namespaceä¸ºä½ è‡ªå·±çš„å‘½åç©ºé—´åç§°
kubectl describe pod mynginx
```

åˆ†é…ç»™k8s-masterèŠ‚ç‚¹å»åˆ›å»ºmynginxçš„åº”ç”¨ï¼Œç„¶åæ‹‰å–é•œåƒï¼Œåˆ›å»ºå®¹å™¨ç­‰ã€‚

![](äº‘åŸç”Ÿ(ä¸€).assets/23.png)

```bash
# æŸ¥çœ‹podçš„è¿è¡Œæ—¥å¿—
# kubectl logs podåå­—
kubectl logs mynginx
```

![](äº‘åŸç”Ÿ(ä¸€).assets/24.png)

### 3.2.4ã€è¿›å…¥Pod

```bash
# æŸ¥çœ‹å½“å‰å‘½åç©ºé—´ä¸‹æ‰€æœ‰çš„Podçš„è¯¦ç»†ä¿¡æ¯
kubectl get pod -owide
```

![](äº‘åŸç”Ÿ(ä¸€).assets/25.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸ªå­—æ®µæ˜¯IPï¼ŒPod çš„å†…éƒ¨ IP åœ°å€ï¼Œç”¨äºåœ¨é›†ç¾¤å†…éƒ¨è¿›è¡Œé€šä¿¡ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„nginxå®¹å™¨çš„ipï¼Œæˆ‘ä»¬çŸ¥é“nginxçš„é»˜è®¤ç«¯å£çš„80ï¼Œæˆ‘ä»¬ä¸å¦¨æµ‹è¯•ä¸€ä¸‹ï¼š

```bash
curl ip:80
```

![](äº‘åŸç”Ÿ(ä¸€).assets/26.png)

æˆ‘ä»¬ä¹‹å‰è¦æ”¹è¿™ä¸ªé¦–é¡µçš„å†…å®¹ï¼Œæˆ‘ä»¬å¾—ä½¿ç”¨`docker exec` å‘½ä»¤å»è¿›å…¥å®¹å™¨çš„ç›®å½•ä¸­æ”¹ï¼Œç°åœ¨å°±å˜æˆäº†ï¼š

- `kubectl exec your_pod -c å®¹å™¨åç§° -n your_namespace -it /bin/bash`

```bash
# kubectl exec -it podå -- /bin/bash
 kubectl exec -it mynginx -- /bin/bashd
 
 # é€€å‡º
 exit
```

![](äº‘åŸç”Ÿ(ä¸€).assets/27.png)

å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªpodé‡Œé¢è£…ä¸¤ä¸ªå®¹å™¨,yamlæ–‡ä»¶å¦‚ä¸‹ï¼š

```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: myapp
  name: myapp
spec:
  containers:
  - image: nginx
    name: nginx
  - image: tomcat
    name: tomcat
```

> æ³¨æ„ï¼š
>
> 1. åŒä¸€ä¸ªPodé‡Œé¢çš„å®¹å™¨äº’ç›¸è®¿é—®ï¼Œåªéœ€è¦`127.0.0.1:ç«¯å£å·`ï¼Œå…¶ä»–Podè¦è®¿é—®è¿™ä¸ªPodï¼Œéœ€è¦`ip:ç«¯å£`
>
> ![](äº‘åŸç”Ÿ(ä¸€).assets/28.png)
>
> 2. åŒä¸€ä¸ªPodé‡Œé¢å¯ä»¥è·‘ä¸¤ä¸ªNginxå®¹å™¨å—ï¼Ÿ**ä¸å¯ä»¥ï¼Œç«¯å£è¢«å ç”¨**
>
> ![](äº‘åŸç”Ÿ(ä¸€).assets/29.png)





## 3.3ã€Deployment

Deploymentå¯ä»¥æ§åˆ¶Podï¼Œä½¿Podæ‹¥æœ‰**å¤šå‰¯æœ¬ï¼Œè‡ªæ„ˆï¼Œæ‰©ç¼©å®¹**ç­‰èƒ½åŠ›ã€‚

### 3.3.1ã€åˆ›å»ºPod

æˆ‘ä»¬ä¹‹å‰æ˜¯ä½¿ç”¨ï¼š`kubectl run mynginx --image=nginx` æ¥åˆ›å»ºPodï¼Œå¦‚æœé‡‡ç”¨Deploymentï¼š

```bash
# å…·å¤‡è‡ªæ„ˆèƒ½åŠ›
kubectl create deployment mynginx --image=nginx
```

> é‡‡ç”¨`kubectl`æ¥åˆ›å»ºå®¹å™¨ï¼Œå…·æœ‰è‡ªæ„ˆèƒ½åŠ›ï¼Œæ¯”å¦‚ä¸å°å¿ƒåˆ æ‰äº†è¿™ä¸ªå®¹å™¨ï¼Œé‚£ä¹ˆk8sä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªå®¹å™¨ã€‚
>
> ```bash
> kubectl delete pod podås
> ```

é‚£å²‚ä¸æ˜¯æ²¡å¾—åˆ äº†ï¼Ÿä¹Ÿå¯ä»¥,åˆ é™¤deployå³å¯:

```bash
# æŸ¥çœ‹Deploymentåˆ›å»ºçš„pod
kubectl get deploy

# åˆ é™¤Deploy
kubectl delete deploy mynginx
```

![](äº‘åŸç”Ÿ(ä¸€).assets/30.png)



### 3.3.2ã€å¤šå‰¯æœ¬



```bash
# --replicas=3 è¡¨ç¤ºåœ¨åˆ›å»º my-dep éƒ¨ç½²æ—¶ï¼ŒKubernetes ä¼šç¡®ä¿å§‹ç»ˆæœ‰ 3 ä¸ªè¿è¡Œä¸­çš„ nginx Pod å‰¯æœ¬
kubectl create deployment my-dep --image=nginx --replicas=3
```

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: my-dep
  name: my-dep
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-dep
  template:
    metadata:
      labels:
        app: my-dep
    spec:
      containers:
      - image: nginx
        name: nginx
```

![](äº‘åŸç”Ÿ(ä¸€).assets/31.png)



### 3.3.3ã€æ‰©ç¼©å®¹

- å°†åä¸º `my-dep` çš„éƒ¨ç½²çš„å‰¯æœ¬æ•°é‡è°ƒæ•´ä¸º 5 ä¸ªã€‚

```bash
# --replicas=5 è¡¨ç¤ºè¦å°†ç›®æ ‡èµ„æºçš„å‰¯æœ¬æ•°é‡è°ƒæ•´ä¸º 5 ä¸ª
# deployment è¡¨ç¤ºè¦æ“ä½œçš„èµ„æºç±»å‹æ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰ï¼Œmy-dep æ˜¯è¯¥éƒ¨ç½²çš„åç§°ã€‚
kubectl scale --replicas=5 deployment/my-dep
```













### 3.3.4ã€è‡ªæ„ˆå’Œæ•…éšœè½¬ç§»

- è‡ªæ„ˆæ˜¯æŒ‡ K8s é›†ç¾¤èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹åˆ°é›†ç¾¤ä¸­çš„æ•…éšœæˆ–å¼‚å¸¸ï¼Œå¹¶è‡ªåŠ¨é‡‡å–æªæ–½æ¥æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€çš„èƒ½åŠ›ã€‚

- æ•…éšœè½¬ç§»æ˜¯æŒ‡åœ¨ K8s é›†ç¾¤ä¸­ï¼Œå½“æŸä¸ªèµ„æºï¼ˆå¦‚èŠ‚ç‚¹ã€Pod æˆ–æœåŠ¡ï¼‰å‘ç”Ÿæ•…éšœæ—¶ï¼Œç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨å°†å·¥ä½œè´Ÿè½½è½¬ç§»åˆ°å…¶ä»–å¯ç”¨çš„èµ„æºä¸Šï¼Œä»¥ä¿è¯åº”ç”¨ç¨‹åºçš„è¿ç»­æ€§å’Œå¯ç”¨æ€§ã€‚







### 3.3.5ã€æ»šåŠ¨æ›´æ–°

æ»šåŠ¨æ›´æ–°æ˜¯ä¸€ç§é€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬ Pod ä¸ºæ–°ç‰ˆæœ¬ Pod çš„æ›´æ–°ç­–ç•¥ï¼Œå®ƒå…è®¸åœ¨æ›´æ–°è¿‡ç¨‹ä¸­æŒç»­æä¾›æœåŠ¡ï¼Œé¿å…äº†ä¼ ç»Ÿçš„å…¨é‡æ›´æ–°å¯èƒ½å¯¼è‡´çš„æœåŠ¡ä¸­æ–­é—®é¢˜ã€‚é€šè¿‡æ»šåŠ¨æ›´æ–°ï¼ŒKubernetes å¯ä»¥åœ¨ä¸å½±å“åº”ç”¨ç¨‹åºå¯ç”¨æ€§çš„å‰æä¸‹ï¼Œå°†æ–°çš„åº”ç”¨ç‰ˆæœ¬é€æ­¥éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚

å·¥ä½œåŸç†ï¼š

1. **æ›´æ–°è§¦å‘**ï¼šå½“ç”¨æˆ·ä¿®æ”¹ Deploymentã€StatefulSet æˆ– DaemonSet ç­‰æ§åˆ¶å™¨çš„é…ç½®ï¼ˆå¦‚æ›´æ”¹å®¹å™¨é•œåƒç‰ˆæœ¬ï¼‰æ—¶ï¼Œæ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¼šè¢«è§¦å‘ã€‚
2. **åˆ›å»ºæ–°ç‰ˆæœ¬ Pod**ï¼šKubernetes ä¼šæ ¹æ®æ–°çš„é…ç½®åˆ›å»ºå°‘é‡æ–°ç‰ˆæœ¬çš„ Podã€‚è¿™äº›æ–° Pod ä¼šç»å†å¥åº·æ£€æŸ¥ï¼ˆå¦‚å­˜æ´»æ¢é’ˆå’Œå°±ç»ªæ¢é’ˆï¼‰ï¼Œç¡®ä¿å®ƒä»¬èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚
3. **é€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬ Pod**ï¼šä¸€æ—¦æ–°ç‰ˆæœ¬ Pod é€šè¿‡å¥åº·æ£€æŸ¥ï¼ŒKubernetes ä¼šå¼€å§‹é€æ­¥åˆ é™¤æ—§ç‰ˆæœ¬çš„ Podã€‚åŒæ—¶ï¼Œä¼šç»§ç»­åˆ›å»ºæ–°çš„ Podï¼Œç›´åˆ°æ‰€æœ‰æ—§ç‰ˆæœ¬ Pod è¢«æ›¿æ¢ä¸ºæ–°ç‰ˆæœ¬ Podã€‚
4. **ç›‘æ§å’Œè°ƒæ•´**ï¼šåœ¨æ•´ä¸ªæ›´æ–°è¿‡ç¨‹ä¸­ï¼ŒKubernetes ä¼šæŒç»­ç›‘æ§ Pod çš„çŠ¶æ€å’Œåº”ç”¨ç¨‹åºçš„å¥åº·çŠ¶å†µã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¦‚æ–°ç‰ˆæœ¬ Pod æ— æ³•é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œæ›´æ–°è¿‡ç¨‹ä¼šæš‚åœï¼Œä»¥é¿å…å½±å“æœåŠ¡çš„å¯ç”¨æ€§ã€‚

```bash
# æ›´æ–° my-dep çš„nginxé•œåƒç‰ˆæœ¬
kubectl set image deployment/my-dep nginx=nginx:1.17.9 --record
```





### 3.3.6ã€ç‰ˆæœ¬å›é€€

ç‰ˆæœ¬å›é€€æ˜¯æŒ‡åœ¨æ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°æ–°ç‰ˆæœ¬å­˜åœ¨é—®é¢˜ï¼ˆå¦‚åº”ç”¨ç¨‹åºå´©æºƒã€æ€§èƒ½ä¸‹é™ç­‰ï¼‰ï¼Œå¯ä»¥å°†åº”ç”¨ç¨‹åºæ¢å¤åˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬ã€‚ç‰ˆæœ¬å›é€€æœºåˆ¶ç¡®ä¿äº†åœ¨æ›´æ–°å‡ºç°é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ¢å¤æœåŠ¡ï¼Œå‡å°‘å¯¹ä¸šåŠ¡çš„å½±å“ã€‚

å·¥ä½œåŸç†ï¼š

1. **è®°å½•ç‰ˆæœ¬å†å²**ï¼šKubernetes ä¼šè®°å½•æ¯æ¬¡æ›´æ–°çš„ç‰ˆæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Deployment çš„é…ç½®å’ŒçŠ¶æ€ã€‚è¿™äº›ä¿¡æ¯è¢«å­˜å‚¨åœ¨ Deployment çš„ä¿®è®¢å†å²ä¸­ï¼Œå¯ä»¥é€šè¿‡ `kubectl rollout history` å‘½ä»¤æŸ¥çœ‹ã€‚
2. **è§¦å‘å›é€€æ“ä½œ**ï¼šå½“éœ€è¦å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬æ—¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ `kubectl rollout undo` å‘½ä»¤æŒ‡å®šè¦å›é€€åˆ°çš„ç‰ˆæœ¬ã€‚Kubernetes ä¼šæ ¹æ®è®°å½•çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå°† Deployment çš„é…ç½®æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬çš„çŠ¶æ€ã€‚
3. **æ‰§è¡Œå›é€€è¿‡ç¨‹**ï¼šå›é€€è¿‡ç¨‹ä¸æ»šåŠ¨æ›´æ–°ç±»ä¼¼ï¼ŒKubernetes ä¼šé€æ­¥å°†æ–°ç‰ˆæœ¬çš„ Pod æ›¿æ¢ä¸ºæ—§ç‰ˆæœ¬çš„ Podï¼Œç›´åˆ°æ‰€æœ‰ Pod éƒ½æ¢å¤åˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬ã€‚

```bash
# æŸ¥çœ‹ my-dep çš„æ›´æ–°å†å²
kubectl rollout history deployment/my-dep

# å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/my-dep

# å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬
kubectl rollout undo deployment/my-dep --to-revision=2
```

![](äº‘åŸç”Ÿ(ä¸€).assets/32.png)

> é™¤äº†Deploymentï¼Œk8sè¿˜æœ‰ `StatefulSet` ã€`DaemonSet` ã€`Job`  ç­‰ ç±»å‹èµ„æºã€‚æˆ‘ä»¬éƒ½ç§°ä¸º `å·¥ä½œè´Ÿè½½`ã€‚æœ‰çŠ¶æ€åº”ç”¨ä½¿ç”¨  `StatefulSet`  éƒ¨ç½²ï¼Œæ— çŠ¶æ€åº”ç”¨ä½¿ç”¨ `Deployment` éƒ¨ç½²



## 3.4ã€Service

å®¹å™¨å¸¦æ¥çš„é—®é¢˜ï¼š

- åœ¨Podåˆ›å»ºä¹‹å‰,ç”¨æˆ·æ— æ³•é¢„çŸ¥Podæ‰€åœ¨èŠ‚ç‚¹ä»¥åŠPodçš„IPåœ°å€
- ä¸€ä¸ªå·²ç»å­˜åœ¨çš„Podåœ¨è¿è¡Œè¿‡ç¨‹ä¸­,å‡ºç°æ•…éšœ,Podä¹Ÿä¼šåœ¨æ–°çš„èŠ‚ç‚¹ä½¿ç”¨æ–°çš„IPè¿›è¡Œéƒ¨ç½²
- åº”ç”¨ç¨‹åºè®¿é—®æœåŠ¡æ—¶,åœ°å€æ˜¯ä¸èƒ½ç»å¸¸è½¬å˜çš„
- å¤šä¸ªç›¸åŒçš„Podå¦‚ä½•è®¿é—®ä»–ä»¬ä¸Šé¢çš„æœåŠ¡

![](äº‘åŸç”Ÿ(ä¸€).assets/33.png)

ä¾‹å¦‚ä¸Šå›¾ä¸‰ä¸ªPodæ˜¯Javaå¾®æœåŠ¡ï¼Œå‰ç«¯Vueï¼Œå‰ç«¯è¦å‘é€è¯·æ±‚ï¼Œéœ€è¦é…ç½®åå°çš„åœ°å€ï¼Œæ˜¾ç„¶ä¸å¯èƒ½é…ç½®æ¯ä¸ªPodçš„IPåœ°å€ï¼Œè€Œæ˜¯æŠŠä¸€ç»„Podå¯¹å¤–æ˜ å°„ä¸ºä¸€ä¸ªServiceï¼Œè¿™æ ·å‰ç«¯åªéœ€è¦é…ç½®Serviceçš„ipåœ°å€ã€‚

```bash
# portä¿¡æ¯å†’å·åé¢çš„ç«¯å£å·å°±æ˜¯å¯¹é›†ç¾¤å¤–æš´éœ²çš„è®¿é—®æ¥å£
kubectl expose deployment my-dep --port=8000 --target-port=80
```

- è¿™æ¡å‘½ä»¤çš„æ•´ä½“ä½œç”¨æ˜¯å°†åä¸º `my-dep` çš„éƒ¨ç½²æš´éœ²ä¸ºä¸€ä¸ªæ–°çš„æœåŠ¡ã€‚è¯¥æœåŠ¡ä¼šåœ¨ç«¯å£ 8000 ä¸Šæ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚è½¬å‘åˆ° `my-dep` éƒ¨ç½²ä¸­å„ä¸ª Pod çš„ç«¯å£ 80 ä¸Šï¼Œä»è€Œå®ç°å¯¹éƒ¨ç½²ä¸­åº”ç”¨ç¨‹åºçš„è®¿é—®ã€‚
- æ¯æ¬¡è®¿é—®Serviceï¼ŒServiceä¼š**è´Ÿè½½å‡è¡¡**å°†è¯·æ±‚åˆ†é…åˆ°ä¸‹é¢ä¸‰ä¸ªnginxå®¹å™¨ä¸­ã€‚

> æ¯ä¸ªpodéƒ½æœ‰ä¸€ä¸ªappæ ‡ç­¾ï¼Œ
>
> ```bash
> kubectl get pods --show-labels
> ```
>
> ![](äº‘åŸç”Ÿ(ä¸€).assets/34.png)
>
> ä¹‹å‰æš´éœ²Serviceçš„å‘½ä»¤ï¼Œ**ä¹Ÿå°±æ˜¯å°†appæ ‡ç­¾ä¸ºmy-depçš„ä¸€ç»„podæš´éœ²ä¸ºä¸€ä¸ªService**ã€‚
>
> - å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨å‘½ä»¤æ£€ç´¢app=my-depçš„æ‰€æœ‰pod
>
> ```bash
> #ä½¿ç”¨æ ‡ç­¾æ£€ç´¢Pod
> kubectl get pod -l app=my-dep
> ```

ServiceæœåŠ¡åŸç†ï¼š

- è‡ªåŠ¨æ„ŸçŸ¥: æœåŠ¡ä¼šåˆ›å»ºä¸€ä¸ªclusterIP,å¯¹åº”èµ„æºåœ°å€,ä¸ç®¡Podå¦‚ä½•å˜åŒ–,æœåŠ¡æ€»èƒ½æ‰¾åˆ°å¯¹åº”çš„Pod,ä¸”clusterIPä¿æŒä¸å˜
- è´Ÿè½½å‡è¡¡: è‹¥æœåŠ¡å™¨åç«¯å¯¹åº”å¤šä¸ªPod,åˆ™ä¼šé€šè¿‡IPTables/LVSè§„åˆ™ è®¿é—®è¯·æ±‚æœ€ç»ˆæ˜ å°„åˆ°Podå®¹å™¨å†…éƒ¨,è‡ªåŠ¨å®ç°å¤šä¸ªå®¹å™¨çš„è´Ÿè½½å‡è¡¡
- è‡ªåŠ¨å‘ç°: æœåŠ¡åˆ›å»ºæ—¶ä¼šè‡ªåŠ¨åœ¨å†…éƒ¨dnsä¸Šæ³¨å†ŒåŸŸå

Serviceå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„åŒç±»Pod**å¯¹å¤–çš„è®¿é—®æ¥å£**ã€‚å€ŸåŠ©Serviceï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚





### 3.4.1ã€æŸ¥çœ‹Service

```bash
kubectl get service
```

![](äº‘åŸç”Ÿ(ä¸€).assets/35.png)

æˆ‘ä»¬ç›´æ¥`curl ClusterIP:8000`æ˜¯å¯ä»¥è®¿é—®åˆ°nginxçš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨nginxå®¹å™¨è¿›è¡Œè®¿é—®Service,ä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„ï¼š

```bash
# Serviceipè®¿é—®
curl Serviceip:8000

# ServiceåŸŸåè®¿é—®(ä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„)
curl my-dep.default.svc:8000
```

![](äº‘åŸç”Ÿ(ä¸€).assets/36.png)

![](äº‘åŸç”Ÿ(ä¸€).assets/37.png)



### 3.4.2ã€åˆ é™¤Service

```bash
kubectl delete service my-dep
```



### 3.4.3ã€ClusterIP

**Serviceæœ‰4ç§ç±»å‹ï¼š**

- ClusterIPï¼šé»˜è®¤å€¼ï¼Œå®ƒæ˜¯Kubernetesç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPï¼Œ**åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®**
- NodePortï¼šå°†Serviceé€šè¿‡æŒ‡å®šçš„Nodeä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œ**å°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡**
- LoadBalancerï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒæ”¯æŒ
- ExternalNameï¼š æŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨

æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„å‘½ä»¤å…¶å®å°±ç­‰åŒäº

```bash
# å°†app=my-depçš„podå¯¹å¤–æš´éœ²ä¸º
kubectl expose deployment my-dep --port=8000 --target-port=80 

# ç­‰åŒäº
kubectl expose deployment my-dep --port=8000 --target-port=80 --type=ClusterIP
```

yamlæ ¼å¼å¦‚ä¸‹ï¼š

```yaml
apiVersion: v1
kind: Service
metadata:
  labels:
    app: my-dep
  name: my-dep
spec:
  ports:
  - port: 8000
    protocol: TCP
    targetPort: 80
  selector:
    app: my-dep
  type: ClusterIP
```







### 3.4.4ã€NodePort

```bash
kubectl expose deployment my-dep --port=8000 --target-port=80 --type=NodePort
```

![](äº‘åŸç”Ÿ(ä¸€).assets/38.png)

- æˆ‘ä»¬å¯ä»¥å‘ç°å¤šæš´éœ²äº†ä¸€ä¸ª30706çš„ç«¯å£ï¼Œè¿™ä¸ªå°±æ˜¯NodePortï¼Œç›¸å½“äºç»™æ¯ä¸ªPodéƒ½å¼€æ”¾äº†ä¸€ä¸ª30706çš„ç«¯å£ã€‚
  - å›¾ä¸­æ˜¯30948ç«¯å£ï¼Œ**NodePortèŒƒå›´åœ¨ 30000-32767 ä¹‹é—´**

![](äº‘åŸç”Ÿ(ä¸€).assets/39.png)

æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é›†ç¾¤å¤–(æµè§ˆå™¨)è®¿é—®ï¼š`å…¬ç½‘ip(å®¿ä¸»æœºip/èŠ‚ç‚¹ip):8000`

![](äº‘åŸç”Ÿ(ä¸€).assets/40.png)



> ä¹Ÿå°±æ˜¯ç»™æ¯å°æœºå™¨éƒ½æš´éœ²äº†8000ç«¯å£ï¼Œåé¢è´Ÿè½½å‡è¡¡æŒ‚è½½äº†nginxã€‚



## 3.5ã€Ingress

Ingressæ˜¯Serviceçš„ç»Ÿä¸€ç½‘å…³å…¥å£ï¼ŒServiceæ˜¯Podçš„ç»Ÿä¸€ç½‘å…³å…¥å£ã€‚å¯ä»¥ç†è§£ä¸ºè¯·æ±‚å…ˆåˆ°Ingressï¼Œå†åˆ°Serviceï¼Œå†åˆ°Podã€‚

> - å®˜ç½‘ï¼šhttps://kubernetes.github.io/ingress-nginx/deploy/
> - Githubï¼šhttps://github.com/kubernetes/ingress-nginx

![](äº‘åŸç”Ÿ(ä¸€).assets/41.png)

å®˜ç½‘çš„ç›®å‰æ˜¯v1.12.0ç‰ˆæœ¬çš„yaml,æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸º`1.14.0`:

```bash
https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.12.0/deploy/static/provider/cloud/deploy.yaml

# ä¿®æ”¹
https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.4.0/deploy/static/provider/cloud/deploy.yaml
```

![](äº‘åŸç”Ÿ(ä¸€).assets/image-20250307001303112.png)

å½“ç„¶è¿™ä¸ª`deploy.yaml`æ–‡ä»¶ä¹Ÿå¯ä»¥åœ¨å®˜æ–¹Githubä»“åº“ä¸­æ‰¾åˆ°:

![image-20250307001400032](äº‘åŸç”Ÿ(ä¸€).assets/image-20250307001400032.png)



### 3.5.1ã€é•œåƒæ›´æ¢

- æˆ‘è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œé¦–å…ˆæŸ¥çœ‹kubectlçš„ç‰ˆæœ¬ï¼š

```bash
kubectl version
```

å¾—åˆ°

```bash
Client Version: version.Info{Major:"1", Minor:"22", GitVersion:"v1.22.12", GitCommit:"b058e1760c79f46a834ba59bd7a3486ecf28237d", GitTreeState:"clean", BuildDate:"2022-07-13T14:59:18Z", GoVersion:"go1.16.15", Compiler:"gc", Platform:"linux/amd64"}

Server Version: version.Info{Major:"1", Minor:"22", GitVersion:"v1.22.12", GitCommit:"b058e1760c79f46a834ba59bd7a3486ecf28237d", GitTreeState:"clean", BuildDate:"2022-07-13T14:53:39Z", GoVersion:"go1.16.15", Compiler:"gc", Platform:"linux/amd64"}
```

- Client Versionä»£è¡¨kubectlçš„ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯v1.22.12
- Server Versionä»£è¡¨masterèŠ‚ç‚¹çš„k8sç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯v1.22.12

æˆ‘ä»¬åœ¨GithubæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬å¯¹åº”ï¼š[Ingress-Nginx](https://github.com/kubernetes/ingress-nginx/tree/controller-v1.6.4?spm=a2c6h.12873639.article-detail.4.715a3cb8PxJ4HL&file=controller-v1.6.4)

![](äº‘åŸç”Ÿ(ä¸€).assets/44.png)





```bash
# ingresså®‰è£…å®Œæˆåä¼šæœ‰ ingress-nginx å‘½åç©ºé—´
kubectl get ns

# å®‰è£…å®Œæˆåä¹Ÿä¼šæœ‰æ–°çš„podå’Œæ–°çš„service 
kubectl get pod,svc -n ingress-nginx
```

![](äº‘åŸç”Ÿ(ä¸€).assets/42.png)

> æ³¨æ„è®°å¾—é˜²ç«å¢™æ”¾è¡ŒIngressçš„ç«¯å£ï¼š
>
> ![](äº‘åŸç”Ÿ(ä¸€).assets/43.png)
>
> - 32096å¯¹åº”çš„æ˜¯HTTPçš„80ç«¯å£ï¼Œ32672å¯¹åº”çš„æ˜¯HTTPSçš„443ç«¯å£ã€‚













- https://blog.csdn.net/qq_22075913/article/details/145326585
- https://blog.csdn.net/2301_78183285/article/details/138656873















## 3.6ã€Helm

 Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ã€‚ç®€åŒ–äº†Kubernetesåº”ç”¨çš„å®‰è£…å’Œç®¡ç†ã€‚å¯ä»¥ç†è§£ä¸ºæ˜¯Linuxçš„yumå·¥å…·ã€‚

- Helm å®šä¹‰äº†ä¸€ç§åº”ç”¨ç¨‹åºåŒ…æ ¼å¼ç§°ä¸ºå›¾è¡¨chartsã€‚ä¸€ä¸ªå›¾è¡¨æ˜¯ä¸€ç»„æè¿°Kubernetesèµ„æºçš„æ–‡ä»¶é›†åˆã€‚
- Helmæ˜¯Kubernetesç”Ÿæ€ç³»ç»Ÿä¸­çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ï¼Œå®ƒå¤§å¹…ç®€åŒ–äº†Kubernetesåº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†æµç¨‹ã€‚

> [Helmç‰ˆæœ¬å¯¹åº”](https://helm.sh/zh/docs/intro/quickstart/)

æˆ‘ä»¬è¦å®‰è£…Helmï¼Œéœ€è¦æˆ‘ä»¬å·²ç»æŠŠKubernetesè£…å¥½åï¼Œæˆ‘è¿™é‡Œæ˜¯Kubernetes v1.22.12ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯Helmçš„3.10.xç‰ˆæœ¬æ”¯æŒã€‚

![image-20250305231056246](äº‘åŸç”Ÿ(ä¸€).assets/image-20250305231056246.png)

1. [Helm 3.10.3ç‰ˆæœ¬ä¸‹è½½](https://github.com/helm/helm/releases?expanded=true&page=2&q=3.10)ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ä¸‹æ¥ä¸Šä¼ ï¼Œä¹Ÿå¯ä»¥curl

```bash
curl -s https://get.helm.sh/helm-v3.10.3-linux-amd64.tar.gz
```



![image-20250305233506776](äº‘åŸç”Ÿ(ä¸€).assets/image-20250305233506776.png)

2. ä¸Šä¼ åˆ°æŸä¸ªç‰¹å®šç›®å½•ï¼Œè¿›è¡Œè§£å‹

```bash
tar -zxvf helm-v3.10.3-linux-amd64.tar.gz 

ls

cd linux-amd64

ls

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
echo $PATH

# ç§»åŠ¨åˆ°ç¯å¢ƒå˜é‡
mv helm  /usr/local/bin


# è¯¢é—®æ˜¯å¦éœ€è¦è¦†ç›–ï¼Œè¾“å…¥yes
```

![image-20250306001151032](äº‘åŸç”Ÿ(ä¸€).assets/image-20250306001151032.png)





![image-20250305235126763](äº‘åŸç”Ÿ(ä¸€).assets/image-20250305235126763.png)

> `helm version` ç¡®ä¿å®‰è£…æˆåŠŸï¼

3. æ·»åŠ ä»“åº“ï¼ŒHelm V3ä¸å†è‡ªå¸¦é»˜è®¤ä»“åº“ã€‚éœ€è¦æ·»åŠ å®˜æ–¹ä»“åº“æˆ–è€…å…¶ä»–ä»“åº“(ä¸æ·»åŠ ä»“åº“ç­‰äºyumæ²¡æœ‰å¯¹åº”çš„repoæ–‡ä»¶)



![image-20250305235322518](äº‘åŸç”Ÿ(ä¸€).assets/image-20250305235322518.png)

4. è¿›å…¥ [ArtifactHub](https://artifacthub.io/packages/search?kind=0),ä¾‹å¦‚æœç´¢Ingress-nginxä»“åº“

![image-20250305235436251](äº‘åŸç”Ÿ(ä¸€).assets/image-20250305235436251.png)



5. æ¯”å¦‚æ·»åŠ Ingressä»“åº“

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
```

![image-20250306001251995](äº‘åŸç”Ÿ(ä¸€).assets/image-20250306001251995.png)

æŸ¥çœ‹æˆ‘ä»¬å®‰è£…çš„ä»“åº“åˆ—è¡¨ï¼š`helm repo list`

![image-20250306001658821](äº‘åŸç”Ÿ(ä¸€).assets/image-20250306001658821.png)

```bash
export http_proxy=http://192.168.100.100:7890
```

6. å®‰è£…å¥½ä»“åº“å°±å¯ä»¥ä½¿ç”¨Helmæ¥å®‰è£…Ingress

```bash
# åˆ›å»ºingress-nginxå‘½åç©ºé—´
kubectl create ns ingress-nginx
# åœ¨ingress-nginxå‘½åç©ºé—´ä¸­å®‰è£…ä¸€ä¸ªåä¸ºingressçš„ingress
helm install ingress ingress-nginx/ingress-nginx -n ingress-nginx
```

> è¿™ä¸ªå¯¹ç½‘ç»œæœ‰ä¸€å®šè¦æ±‚ï¼Œå¯èƒ½ä¼šè£…ä¸æˆåŠŸã€‚

ç®€å•æ¥è¯´Helmå®é™…ä¸Šåªæ˜¯Linuxçš„çš„äºŒè¿›åˆ¶å‘½ä»¤ï¼Œå®ƒéœ€è¦é…åˆä»“åº“é…ç½®æ‰èƒ½ä½¿ç”¨ï¼Œç±»ä¼¼yumå‘½ä»¤ã€‚å°±å¯ä»¥å®Œæˆå½“å‰é›†ç¾¤ä¸€é”®å®‰è£…å‡çº§å¸è½½åº”ç”¨çš„åŠŸèƒ½ã€‚



### 3.6.1ã€ğŸ”¥å¢åŠ Helmæº

> - å®˜æ–¹æ–‡æ¡£ï¼š[Helm Charts Hub](https://helm-charts.itboon.top/docs/)

ç”±äºå›½å†…ä¸å¯æŠ—åŠ›åŸå› ï¼Œè¿™é‡Œå¢åŠ Helmæºå¦‚ä¸‹ï¼š

```bash
# helm repo add [è‡ªå®šä¹‰åå­—] url
helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
helm repo add bitnami "https://helm-charts.itboon.top/bitnami" --force-update
helm repo add grafana "https://helm-charts.itboon.top/grafana" --force-update
helm repo add prometheus-community "https://helm-charts.itboon.top/prometheus-community" --force-update
helm repo add ingress-nginx "https://helm-charts.itboon.top/ingress-nginx" --force-update


# æ›´æ–°ä»“åº“
helm repo update

# æŸ¥çœ‹ä»“åº“åˆ—è¡¨
helm repo list

# æŸ¥çœ‹ç›®å‰å®‰è£…çš„
helm list
```

![image-20250306144909639](äº‘åŸç”Ÿ(ä¸€).assets/image-20250306144909639.png)



```bash
# æŸ¥æ‰¾ingressä»“åº“
helm search repo ingress-nginx
# åˆ›å»ºå‘½åç©ºé—´
kubectl create ns ingress-nagin
# å®‰è£…ingress
helm install ingress ingress-nginx/ingress-nginx -n ingress-nginx
```





























